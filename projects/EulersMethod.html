<html>
	<head>
		<style>
		h5 {
			font-family: Sans-Serif
		}
		p {
			font-family: monospace
		}
		
		table, th, td {
			border: 1px solid black;
			border-collapse: collapse;
			padding: 3px;
		}
		table.in, td.in {
			border: 0px;
			border-collapse: collapse;
			padding: 0px;
		}
		
		</style>
		<script type="text/javascript">

      let canvas;

      function init(){
        
        canvas = document.getElementById("graph");
        
        canvas.width = document.getElementById("canvasTd").offsetWidth;
        canvas.height = document.getElementById("canvasTd").offsetHeight;

      }

			function evalFunc(f, x, y){

        let pi = Math.PI;
        let e = Math.exp(1);

        function sin(x){ return Math.sin(x); }
        function cos(x){ return Math.cos(x); }
        function tan(x){ return Math.tan(x); }
        function asin(x){ return Math.asin(x); }
        function acos(x){ return Math.acos(x); }
        function atan(x){ return Math.atan(x); }
        function sinh(x){ return Math.sinh(x); }
        function cosh(x){ return Math.cosh(x); }
        function tanh(x){ return Math.tanh(x); }
        function asinh(x){ return Math.asinh(x); }
        function acosh(x){ return Math.acosh(x); }
        function atanh(x){ return Math.atanh(x); }
        function log(x){ return Math.log10(x); }
        function ln(x){ return Math.log(x); }
        
				f = f.replace(/\^/g, "**");
				console.log(f);
				return eval(f);
			}
			
			function calculate(){
				let func = document.getElementById("inFunc").value;
				let x0 = parseFloat(document.getElementById("inX0").value);
				let y0 = parseFloat(document.getElementById("inY0").value);
				let h = parseFloat(document.getElementById("inH").value);
				let b = parseFloat(document.getElementById("inB").value);
				
				let n = ((b-x0)/h)+1;

        let xs = [x0];
        let ys = [y0];

        try{
				
  				
  				for(let i = 1; i < n; i++){
  					let nexty = ys[i-1] + h*evalFunc(func, xs[i-1], ys[i-1]);
  					if(!isFinite(nexty)){
  						if(isNaN(nexty)){
  							alert("Unable to continue, result is undefined.");
  						}else{
  							alert("Unable to continue, result out of bounds.");
  						}
  						break;
  					}
  					xs[i] = xs[i-1]+h;
  					ys[i] = nexty;
  				}
  				console.log(xs, ys);

        }catch(e){
          alert("Failed to evaluate function.");
          return;
        }
				
				let table = document.getElementById("outputs");
				while(table.rows.length > 0) {
					table.deleteRow(0);
				}
				let row = table.insertRow(0);
				let cell1 = row.insertCell(0);
				let cell2 = row.insertCell(1);
				cell1.innerHTML = "<center><b>x</b></center>";
				cell2.innerHTML = "<center><b>y</b></center>";
				for(let i = 0; i < xs.length; i++){
					let row = table.insertRow(i+1);
					let cell1 = row.insertCell(0);
					let cell2 = row.insertCell(1);
					cell1.innerHTML = parseFloat(xs[i].toFixed(12));
					cell2.innerHTML = parseFloat(ys[i].toFixed(12));
				}
				
				drawGraph(canvas, xs, ys);
				
			}
			
			function drawGraph(canvas, xs, ys){
				let xMin = parseFloat(Math.min.apply(Math, xs).toFixed(12));
				let xMax = parseFloat(Math.max.apply(Math, xs).toFixed(12));
				let yMin = parseFloat(Math.min.apply(Math, ys).toFixed(12));
				let yMax = parseFloat(Math.max.apply(Math, ys).toFixed(12));

        if(xMin == xMax){
          xMin-=0.5;
          xMax+=0.5;
        }
        if(yMin == yMax){
          yMin-=0.5;
          yMax+=0.5;
        }

				
				let graphX = 32.5;
				let graphY = 16.5;
				let graphW = canvas.width-64;
				let graphH = canvas.height-32;
				
				let ctx = canvas.getContext("2d");
				ctx.clearRect(0, 0, canvas.width, canvas.height);
				
				ctx.beginPath();
				ctx.strokeStyle = "lightGray";
				//ctx.moveTo(graphX, graphY);
				//ctx.lineTo(graphX, graphY+graphH);
				//ctx.lineTo(graphX+graphW, graphY+graphH);
				
				let hTicks = 5;
				let vTicks = 5;
				
				ctx.font="12px Verdana";
				ctx.textAlign="center"; 
				//ctx.fillText("y",graphX-4, graphY-6);
				//ctx.fillText("x",graphX+graphW+4, graphY+graphH+3);
				for(let i=0; i <= hTicks; i++){
					let d = parseFloat((xMin+(xMax-xMin)/hTicks*i).toFixed(Math.min(5, Math.ceil(-Math.log10((xMax-xMin)-Math.floor((xMax-xMin)))))));
					ctx.moveTo(graphX+(graphW/hTicks*i), graphY);
					ctx.lineTo(graphX+(graphW/hTicks*i), graphY+graphH+2);
					ctx.fillText(d, graphX+(graphW/hTicks*i), graphY+graphH+12, graphW/hTicks);
				}
				ctx.textAlign="right"; 
				for(let i=0; i <= vTicks; i++){
					let d = parseFloat((yMin+(yMax-yMin)/vTicks*i).toFixed(Math.min(5, Math.ceil(-Math.log10((yMax-yMin)-Math.floor((yMax-yMin)))))));
					ctx.moveTo(graphX, Math.round(graphY+(graphH/vTicks*i)));
					ctx.lineTo(graphX+graphW, graphY+(graphH/vTicks*i));
					ctx.fillText(d, graphX, graphY+(graphH/vTicks*(vTicks-i)), graphW/vTicks);
				}
				
				ctx.stroke();
				
				
				ctx.beginPath();
				ctx.strokeStyle = "blue";
				
				for(let i=0; i < xs.length; i++){
					xp = graphX+((xs[i]-xMin)/(xMax-xMin))*graphW;
					yp = graphY+(1-(ys[i]-yMin)/(yMax-yMin))*graphH;
					if(i == 0){
						ctx.moveTo(xp, yp);
					}else{
						ctx.lineTo(xp, yp);
					}
					ctx.fillRect(xp-0.5, yp-0.5, 1, 1);
				}
				ctx.stroke();
				
				ctx.beginPath();
				
				for(let i=0; i < xs.length; i++){
					xp = graphX+((xs[i]-xMin)/(xMax-xMin))*graphW;
					yp = graphY+(1-(ys[i]-yMin)/(yMax-yMin))*graphH;
					ctx.fillRect(xp-1, yp-1, 3, 3);
				}
				ctx.fill();
			}
		
		</script>
	</head>
	<body onload="init()">
		<h5>
      First Order Ordinary Differential Equation Estimator using Euler's Method
      <br />
      Created by Braeden Atlee on 10/26/2017
    </h5>
		<table class="in" width="100%" height="90%">
			<tr>
				<td class="in" valign="top">
					<table class="in">
						<tr><td class="in"><p>f'= f(x,y)= </p></td><td class="in"><input type="text" id="inFunc" value="x^3*e^(-2*x)-2*y"></input></td></tr>
						<tr><td class="in"><p>x0 = </p></td><td class="in"><input type="text" id="inX0" value="0"></input></td></tr>
						<tr><td class="in"><p>y(x0) = </p></td><td class="in"><input type="text" id="inY0" value="1"></input></td></tr>
						<tr><td class="in"><p>Step Size: </p></td><td class="in"><input type="text" id="inH" value="0.1"></input></td></tr>
						<tr><td class="in"><p>Maximum x: </p></td><td class="in"><input type="text" id="inB" value="2"></input></td></tr>
						<tr><td span="2" class="in"><button type="button" onclick="calculate()">Estimate</button></td></tr>
					</table>
					<br />
					<table id="outputs">
					</table>
				</td>
				<td class="in" valign="top" id="canvasTd">
					<canvas id="graph" width="400", height="300"></canvas>
				</td>
			</tr>
		</table>
	</body>

</html>