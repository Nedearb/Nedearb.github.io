<html>
<head>
    <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
    <script type="text/javascript">

        let canvas;
        let canvasEle;
        let context
        let width;
        let height;

        let interval;

        let placingAnchors = false;
        let placingFirstPoint = false;
        let running = false;

        let jumpFraction = 0.5;
        let xPostJump = 0;
        let yPostJump = 0;

        let anchors;
        let activePoint = {"x":0, "y":0};

        let reset = function(){

            anchors = [];

            context.fillStyle = "#000000";
            context.fillRect(0, 0, width, height);

            $("#mainButton").html("Press when done placing anchors");
            $("#mainButton").prop("disabled", true);
            placingAnchors = true;
            
            updateJumps();


        }

        let updateJumps = function(){
            jumpFraction = parseFloat($("#jumpFraction").val());
            //xPostJump = parseFloat($("#xPostJump").val());
            //yPostJump = parseFloat($("#yPostJump").val());
        }

        let stop = function(){
            clearInterval(interval);
            running = false;
        }

        let drawPoint = function(p){
            context.fillStyle = "#FFFFFF";
            context.fillRect(p.x, p.y, 1, 1);
            //console.log(p);
        }

        let tick = function(){
            if(running){
                let to = anchors[Math.floor(Math.random()*anchors.length)];
                let dx = (to.x - activePoint.x) * jumpFraction;
                let dy = (to.y - activePoint.y) * jumpFraction;
                activePoint.x += dx + xPostJump;
                activePoint.y += dy + yPostJump;
                drawPoint(activePoint);
            }
        }

        $(function() {

            canvas = $("#mainCanvas");
            canvasEle = canvas.get(0);
            context = canvasEle.getContext("2d");
            width = canvas.width();
            height = canvas.height();

            canvas.click(function(e){
                //console.log(e);
                if(placingAnchors){
                    let x = e.clientX - canvasEle.offsetLeft;
                    let y = e.clientY - canvasEle.offsetTop;
                    anchors.push({"x":x, "y":y});
                    $("#mainButton").prop("disabled", false);
                    context.fillStyle = "#FF0000";
                    context.fillRect(x-2, y-2, 4, 4);
                }else if(placingFirstPoint){
                    let x = e.clientX - canvasEle.offsetLeft;
                    let y = e.clientY - canvasEle.offsetTop;
                    activePoint = {"x":x, "y":y};
                    $("#mainButton").prop("disabled", false);
                    $("#mainButton").html("Start");
                    drawPoint(activePoint);
                }
            });

            $("#mainButton").click(function(){
                if(placingAnchors){
                    placingAnchors = false;
                    $("#mainButton").html("Place first point...");
                    $("#mainButton").prop("disabled", true);
                    placingFirstPoint = true;
                }else if(placingFirstPoint){
                    placingFirstPoint = false;
                    $("#mainButton").html("Stop");
                    running = true;
                    interval = setInterval(tick, 1);
                }else if(running){
                    $("#mainButton").html("Reset");
                    stop();
                }else{
                    reset();
                }
            });

            reset();

        });

    </script>
</head>
<body>

    <canvas width="640" height="480" id="mainCanvas"></canvas>
    <br />
    <button id="mainButton"></button>
    <br />
    Jump Fraction: <input onchange="updateJumps" id="jumpFraction" type="text" value="0.5">
    
</body>
</html>